#+title:磁盘配额(quota)与进阶文件系统管理
#+author:ray
#+date:<2016-04-26 Tue>


* 磁盘配额的应用与操作
  使用 quota 来管理主机上的磁盘容量。


** 什么是 quota

   quota 来保证主机上 磁盘容量的平均分配

*** Quota 的一般用途

+ 对 WWW server 每个人的网页空间的容量限制
+ 对 mail server 每个人邮件空间的限制
+ 对 file server 每个人最大的可用网络磁盘空间
+ 针对某一组群所能使用的最大磁盘配额
+ 限制某一个用户的最大的磁盘配额
+ 以 Link 的方式，来使邮件可以作为限制的配额



*** Quota 的使用限制

+ 仅能针对整个 filesystem
+ Linux 核心必须支持 quota
+ Quota 的记录档，记录着每个用户拥有的文件总数与总容量，根据这些来重新规划磁盘配额。
+ 只对一般的用户有效，因为所有的 filesystem 都是 root




*** Quota 的规范配置

+ 容量限制或者文件数量限制
+ 柔性劝导与硬性规定
+ 会倒计时的宽限时间


* 软件磁盘阵列 (RAID)

** RAID
  软件磁盘阵列(容错式廉价磁盘阵列)，将一些小的磁盘空间整理成一个较大的磁盘。

*** RAID-0(等量模式，stripe):效能最佳
这种模式如果使用相同型号与容量的磁盘来组成时，效果是最好的。RAID-0 只要有任何一个磁盘被损毁，那么 RAID 上面的所有数据就会遗失而无法读取。

*** RAID-1(映射模式，mirror): 完整备份

让同一份数据，完整的保存在两个磁盘上。

*** RAID 0+1,RAID 1+0

+ RAID 0+1:先让两个磁盘组成 RAID0，这样的配置总共有两组，将两组 RAID 0再组成一组 RAID1.
+ RAID 1+0: 与 RAID 0 + 1 相反。


*** RAID 5:效能与数据备份的均衡考量

   至少需要三个以上的磁盘才能组成这种类型的磁盘阵列。在数据被写入的时候，会有同位检查码产生，并且这些检查码每次都在不同的磁盘。
当损毁的磁盘大于两个时，磁盘数据就会损毁，损毁一个的时候可以通过同位检查码将数据恢复回来。

*** Spare Disk 预备磁盘的功能

磁盘损毁时，就将坏掉的磁盘拔掉，然后换上新的磁盘，磁盘阵列就会自动开始重建数据。

*** 磁盘阵列的优点

+ 数据安全与恢复：在紧急情况下，可以利用数据重建来恢复救急数据。
+ 读写性能：例如 RAID0 可以加强读写性能，提高系统 I/O 部分
+ 容量: 让多个磁盘系统组合起来，所以单一的文件系统可以有相当大的容量

** software, hardware RAID

+ 硬件磁盘阵列是透过磁盘阵列卡来达成阵列的目的，磁盘阵列卡上面有一块专门的芯片在处理 RAID 的任务(价格贵)。
+ 软件磁盘阵列是利用软件来模拟磁盘阵列的功能，但是会耗费比较多的 CPU 资源。


** 软件磁盘阵列的配置

使用 mdadm 进行配置。

* 逻辑卷轴管理员(Logic Volume Manager)

LVM 可以动态的调整 filesystem 的容量。

** 什么是 LVM: PV,PE,VG,LV 的意义

*** PV (physical Volume) 实体卷轴

需要通过 fdisk 将 system ID 调整为 8e 之后才能使用。

*** VG (Volume Group) 卷轴群组

LVM 大磁盘，就是将许多的 PV 整合成 VG。

*** PE (Physical Extend) 实体延伸模块

PE 是整个 LVM 里面最小的存储区块

*** LV (Login Volume) 逻辑卷轴
    LV 的大小是 PE 的整数倍。

在通过 PV VG LV 的规划后，就可以利用 mkfs 将 LV 格式化成为可利用的文件系统了。这个文件系统的大小可以动态的扩充或者减小，而且里面的数据
还不会有影响。LVM 的主要用处还是实现一个可以动态调整的文件系统，而不是创建一个性能为主的磁盘。
