#+title:第九章 文件与文件系统的压缩与打包
#+author: lemon
#+date:<2016-03-21 Mon>

* 压缩文件的用途与技术

** 压缩文件的用途与技术
   文件过大会导致携带不变以及浪费过多的网络资源。压缩技术在这就起到了很重要的作用。压缩技术大致可以分为以下的部分:


   + 压缩：充分利用文件中的多余空间，或者对文件重复的数据进行统计。
   + 解压缩：将文件还原为压缩前的一样。
   + 压缩比：压缩前与压缩后文件所占的磁盘空间大小的比率，称之为压缩比。

* Linux 系统常见的压缩命令

linux 支持的压缩命令非常多，不同的压缩技术所对应的压缩命令并不相同，

| 参数      | 命令                                     |
|-----------+------------------------------------------|
| *.Z       | compress 程序压缩的文件                  |
| *.gz      | gzip 程序压缩的文件                      |
| *.bz2     | bzip2程序压缩的文件                      |
| *.tar     | tar 程序打包的数据，并没有压缩过         |
| *.tar.gz  | tar 程序打包的文件，并且经过 gzip 的压缩 |
| *.tar.bz2 | tar 程序打包的文件，并且经过bzip2 的压缩                |

*** compress

这个命令已经是非常老的一款软件。现在 gzip 可以打开 compress 的压缩文件。

*** gzip zcat

gzip 是应用的很广的软件。 gzip 可以调不同的压缩等级，有 1~9个等级。

*** bzip2 bzcat
    bzip2 是为了取代 gazip 并且提供更佳的压缩比而来的。用法几乎和 gzip 相同。

* 打包命令

之前提到的命令只能针对单一文件来进行压缩。linux 中的 tar 命令可以将多个文件或者目录包成一个大文件的功能。

| 参数 | 意义                                              |
|------+---------------------------------------------------|
| -c   | 创建打包文件                                      |
| -t   | 查看打包文件的内容有哪些文件名                    |
| -x   | 解打包或者解压缩 -c -t -x 不能出现在同一串命令中  |
| -j   | 通过 bzip2 的支持进行压缩/解压缩                  |
| -z   | 通过 gzip 的支持进行压缩/解压缩                   |
| -v   | 在压缩/解压缩的过程中，将正在处理的文件名显示出来 |
| -f   | 后面要立刻接要被处理的文件名                      |
| -C   | 这个选项用在解压缩，指定特定命令解压缩                               |


这个打包命令可以用来:

+ 使用 tar 加入 -j 或 -z 来进行备份，比如 /etc、目录
+ 查看 tar 文件的数据内容
+ 将备份数据解压缩，并考虑特定命令进行解压
+ 仅解开单一文件
+ 打包某目录，但不含该目录下的某些文件
+ 仅备份比某个时刻还要新的文件
+ 特殊应用：利用管道命令与数据流

* 完整备份工具 dump restore

** dump

dump 有着很强的备份功能，除了可以备份完整的文件系统之外，还可以制定等级，例如对 /home 目录的备份，进行第一次备份之后，在后续的
备份中就可以指定备份等级，假如指定等级为 1 时，此时新备份的数据只会记录与第一次备份有所差异的文件(这个就有点 git 的意思了)。

但是 dump 也是有限制的：

+ 当待备份的数据为单一文件系统时：
  如果是单一文件系统，那么该文件系统就能完整使用 dump 的功能。
+ 待备份的数据是目录，不是单一的文件系统
  - 所有的备份数据都必须要在该目录下
  - 仅仅能使用 level0， 也就是只支持完整备份
  - 不支持 -u 参数，也就是无法创建 /etc/dumpdates 这个各级别备份的时间记录文档


| 参数   | 意义                                                |
|--------+-----------------------------------------------------|
| -S     | 列出后面的待备份数据需要多少磁盘空间才能够备份完    |
| -u     | 将这次的 dump 的时间记录到 /etc/dumpdates 中        |
| -v     | 将 dump 的文件过程显示出来                          |
| -j     | 加入bzip2 的支持，将数据进行压缩，默认的压缩等级为2 |
| -level | 备份等级，0~9，共10个压缩等级                       |
| -f     | 有点类似 tar，后面接产生的文件                      |
| -W     | 列出在 /etc/fstab 里面的具有的 dump 配置的 partition 是否有备份      |

** restore

备份就是在紧急情况下可以回复系统的重要数据， dump的复原使用的是 restore 这个命令。

| 参数 | 意义                                                               |
|------+--------------------------------------------------------------------|
| -t   | 查看 dump 的备份数据中有什么重要的数据，类似 tar -t 功能           |
| -C   | 将 dump 内的数据拿出来与当前的文件数据比较                         |
| -i   | 进入互动模式。仅可以还原部分文件，用在 dump 目录时的还原           |
| -r   | 将整个 filesystem 还原的一种模式，用在还原针对文件系统的 dump 还原 |
| -h   | 查看完整备份数据中 inode 与文件系统 label                          |
| -f   | 接要处理的 dump 文件                                               |
| -D   | 与 -C 搭配使用，可以查出后面接的挂载点与 dump 内有不同的文件                                |


一般用于：

+ 查看 dump 后的备份数据内容
+ 比较差异并且还原整个文件系统
+ 仅还原部分文件的 restore 互动模式。

* 光盘写入工具

通常基于命令行的录制过程如下：

+ 先将所需要备份的数据做成一个 iso 文件，利用 mkisofs 命令来处理
+ 将该 iso 文件刻录到光盘或者 DVD 中， 利用 cdrecord 命令来处理

* 其他常见的压缩与备份工具

** dd

tar 可以用来备份关键数据，dd 则可以用来备份整个分区或者磁盘。

** cpio

cpio 可以用来备份任何东西，包括设备文件。但是 cpio 不会主动的去找文件来备份，需要 find 命令的辅助。
